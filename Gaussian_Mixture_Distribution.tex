\documentclass[CJK]{ctexart}
\usepackage{CJK}
\usepackage{color}
\usepackage{amsmath}
\usepackage{listings}
\usepackage[framed,numbered,autolinebreaks,useliterate]{mcode}
\usepackage{textcomp}
\CTEXsetup[format={\Large\bfseries}]{section}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{lastpage}
\usepackage{float}
\usepackage[superscript]{cite}
\usepackage{geometry}
\usepackage{bm}
\newtheorem{definition}{\hspace{2em}定义}
\newtheorem{theorem}{\hspace{2em}定理}
\newtheorem{lemma}{\hspace{2em}引理}
\newtheorem{proof}{\hspace{2em}证明}
\newtheorem{algorithm}{\hspace{2em}算法}
\newtheorem{conclusion}{\hspace{2em}结论}

\newcommand*{\dif}{\mathop{}\!\mathrm{d}}
\geometry{left=3cm,right=3cm,top=1.5cm,bottom=1.5cm}

\begin{document}
\title{\textbf{混合高斯分布}}
\author{518030910150 方泓杰}
\date{Nov. 2nd, 2019}
\maketitle

\section{问题简述}

\begin{definition} [混合高斯分布]

设$X \sim N(\mu_1, \sigma_1^2), Y \sim N(\mu_2, \sigma_2^2)$，则将 $Z = X + \eta Y$ 服从的分布称为参数为 $\mu_1, \sigma_1; \mu_2, \sigma_2; p$ 的混合高斯分布。其中，$\eta$ 的分布列如下：

\begin{table}[H]
\caption{$\eta$ 分布列}
\begin{center}
\begin{tabular}{|c|c|c|}
\hline
$\eta$ & $0$ & $1$ \\
\hline
$P$ & $1 - p$ & $p$ \\
\hline
\end{tabular}
\end{center}
\label{tab1}
\end{table}

\end{definition}

\textbf{问题一}

\begin{itemize}
\item 自己设定参数，用计算机生成 10000 个混合高斯分布的随机数；
\item 画出其频率分布直方图；
\item 讨论不同参数对其分布“峰”的影响。
\end{itemize}

\textbf{问题二}

自己设定参数，用计算机生成 1000 组，每组 $n$ 个混合高斯分布的随机数，设第 $i$ 组的随机数为 $Z_{i, 1}, Z_{i, 2}, ..., Z_{i, n}$，且给出

\begin{equation}
    U_i = \frac{\sum_{j=1}^n{Z_{i, j}} - n \cdot E(Z_i)}{\sqrt{n \cdot D(Z_i)}}
    \label{eq1}
\end{equation}

\begin{itemize}
\item 画出 $U_1, U_2, ..., U_{1000}$ 的频率分布直方图；
\item 讨论 $n = 10, 20, 50, 100, 1000$ 对频率分布直方图“峰”的影响。
\item 你能从中得出何结论。
\end{itemize}


\section{关于混合高斯分布的简单讨论}

我们首先讨论混合高斯分布的分布函数以及概率密度函数，来大致了解一下混合高斯分布的一些基本性质以及规律。

\begin{displaymath}
    F_Z(z) = P(X + \eta Y \leq z) = P(X \leq z | \eta = 0) \cdot P(\eta = 0) + P(X + Y \leq z | \eta = 1) \cdot P(\eta = 1)
\end{displaymath}

由于 $X, Y, \eta$ 相互独立，上式可化为：

\begin{equation}
    F_Z(z) = (1 - p) P(X \leq z) + p P(X + Y \leq z) = (1 - p) F_X(z) + pF_{X + Y}(z)
    \label{eq2}
\end{equation}

其中，$F_{X + Y}(\cdot)$ 为 $X + Y$ 的分布函数，由结论知，$X + Y \sim N (\mu_1 + \mu_2, \sigma_1^2 + \sigma_2^2)$。于是我们得到了 $Z$ 的分布函数如 \eqref{eq3} 式所示，再在 \eqref{eq2} 中两边对 $z$ 求导即得 $Z$ 的概率密度函数。

\begin{equation}
    f_Z(z) = \frac{\dif}{\dif z} F_Z(z) = (1 - p) \frac{\dif}{\dif z} F_X(z) + p \frac{\dif}{\dif z} F_{X + Y}(z) = (1 - p) f_X(z) + p f_{X+Y}(z)
    \label{eq3}
\end{equation}

在 \eqref{eq3} 式中代入 $f_X(\cdot), f_{X + Y}(\cdot)$ 的表达式，有

\begin{equation}
    f_Z(z) = (1 - p) \frac{1}{\sqrt{2 \pi} \sigma_1} e^{-\frac{(z - \mu_1)^2}{2\sigma_1^2}} + p \frac{1}{\sqrt{2 \pi} \sqrt{\sigma_1^2 + \sigma_2^2}} e^{-\frac{(z - \mu_1 - \mu_2)^2}{2(\sigma_1^2 + \sigma_2^2)}}
    \label{eq4}
\end{equation}

\section{问题一的解答}

\subsection{服从混合高斯分布的随机数的生成}
\begin{algorithm}[舍选法\cite{bib1}]
    设 $f(\cdot)$ 为密度函数，且 $\sup{f(x)} = f_0 < \infty$，且满足 $f(x) = 0 (\forall x \notin [a, b])$，那么生成以 $f(\cdot)$ 为密度函数的随机变量 $X$ 的舍选算法如下：
    \begin{enumerate}
    \item 生成 $[0, 1]$ 上的独立均匀随机数 $U$ 和 $V$，令$u = a + (b - a) U, v = f_0 V$；
    \item 若 $v \leq f(u)$ 则输出 $u$；否则转 1。
    \end{enumerate}
    \label{algo1}
\end{algorithm}

算法 \ref{algo1} 给出了一种给出密度函数 $f(\cdot)$ 生成随机数的方法。容易将其应用在混合高斯分布的生成上，由于混合高斯分布中，$\lim_{x \rightarrow \infty} f(x) = 0$，所以可以取一个很小的$a$和很大的$b$（如$a = -10^9, b = 10^9$），则可以近似满足舍选法的条件，从而利用舍选法产生随机数。

舍选法的相关正确性的证明可以参见参考文献\cite{bib1}，这里不再赘述。

若对于区间 $[a, b]$ 中的大部分 $x$，$f(x) < \varepsilon$，其中 $\varepsilon$ 为一个小量，则舍选法的步骤 2 大概率会转到步骤 1 继续选取，从而效率较为低下。针对于混合高斯分布，不仅算法效率较低，而且由式 \eqref{eq4} ，密度函数的描述过于繁琐，因此不作为生成服从混合高斯分布的随机数的首选。

在实际实现过程中，如果我们可以生成服从正态分布的随机数以及服从均匀分布的随机数，我们就可以利用下面这个简单的方法来获得产生随机数。

\begin{algorithm} 生成服从参数为 $\mu_1, \sigma_1; \mu_2, \sigma_2; p$ 的混合高斯分布的随机数的算法如下：
    \begin{enumerate}
    \item 生成满足 $X \sim N(\mu_1, \sigma_1)$ 的随机变量 $X$；生成满足 $Y \sim N(\mu_2, \sigma_2)$ 的随机变量 $Y$；
    \item 生成满足 $\eta' \sim U(0, 1)$ 的随机变量 $\eta'$，如果$\eta' \leq p$，则令 $\eta = 1$；否则 $\eta = 0$；
    \item 令 $Z = X + \eta Y$，则 $Z$ 为服从参数为 $\mu_1, \sigma_1; \mu_2, \sigma_2; p$ 的混合高斯分布的随机数。
    \item 如果生成的随机数数量满足要求则退出，否则转 1。
    \end{enumerate}
    \label{algo2}
\end{algorithm}

下面我们简要说明一下这个算法的正确性：首先，由于在混合高斯分布中，$X, Y, \eta$ 三个随机变量相互独立，因此可以独立生成；其次，按照算法流程，生成的随机变量$X, Y$ 可以满足 $X \sim N(\mu_1, \sigma_1), Y \sim N(\mu_2, \sigma_2)$；然后，我们先生成了一个 $(0, 1)$ 内均匀分布的随机变量 $\eta'$ ，那么，由随机分布的分布函数知，$P(\eta' \leq p) = F_{\eta'}(p) = p, P(\eta' > p) = 1 - P(\eta' \leq p) = 1 - p$，因此按照算法 \ref{algo2} 所述规则生成的随机变量 $\eta$ 满足表 \ref{tab1} 所示的分布列，从而生成的随机数 $Z = X + \eta Y$ 服从参数为 $\mu_1, \sigma_1; \mu_2, \sigma_2; p$ 的高斯混合分布。

由于 Matlab 中内置了生成正态分布和平均分布的函数，因此我们可以利用 Matlab 非常方便的实现算法 \ref{algo2}，代码如下：

\lstinputlisting{GM_gen.m}

设置参数为$\mu_1 = 0, \sigma_1 = 2; \mu_2 = 10, \sigma_2 = 5; p = 0.6$，则上述代码运行后产生的 10000 组随机数见 data 文件夹下的 gaussian\_mixture\_data.csv 文件，所绘制的频率分布直方图如图 \ref{fig1} 所示。

\begin{figure}[H]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=2.8in]{fig/fig1.jpg}\\
  \caption{参数为 $\mu_1 = 0, \sigma_1 = 2; \mu_2 = 10, \sigma_2 = 5; p = 0.6$ 的高斯混合分布的随机数频率分布直方图}\label{fig1}
\end{figure}

\subsection{讨论参数对于混合高斯分布的影响}

从式\eqref{eq4}中的密度函数我们可以看出，混合高斯分布的密度函数实际上是两个正态分布密度函数的加权平均，其中权重分别为 $p$ 和 $(1-p)$；因此权重 $p$ 对于混合高斯分布的影响非常重要，因此我们先来讨论参数 $p$ 对于混合高斯分布的影响。

我们选取$\mu_1 = 0, \sigma_1 = 2; \mu_2 = 10, \sigma_2 = 5$，分别用上述 Matlab 代码在 $p = 0, p = 0.2, p = 0.4, p = 0.6, p = 0.8$ 和 $p = 1.0$ 时各生成了 10000 组随机数，可参见 data 文件夹下的 data2-0.csv, data2-1.csv, ..., data2-5.csv 文件，并分别绘制了他们的频率分布直方图如下：

\begin{figure}[H]
\centering
\subfigure[$p = 0.0$]{
\includegraphics[width=7cm]{fig/fig2-0.jpg}
%\caption{fig1}
}
\quad
\subfigure[$p = 0.2$]{
\includegraphics[width=7cm]{fig/fig2-1.jpg}
%\caption{fig1}
}
\quad
\subfigure[$p = 0.4$]{
\includegraphics[width=7cm]{fig/fig2-2.jpg}
}
\quad
\subfigure[$p = 0.6$]{
\includegraphics[width=7cm]{fig/fig2-3.jpg}
}
\quad
\subfigure[$p = 0.8$]{
\includegraphics[width=7cm]{fig/fig2-4.jpg}
}
\quad
\subfigure[$p = 1.0$]{
\includegraphics[width=7cm]{fig/fig2-5.jpg}
}
\caption{不同参数 $p$ 下生成的随机数的频率分布直方图}
\label{fig2}
\end{figure}

由于样本足够大，可以由频率估计概率，因此频率分布直方图的边缘曲线和混合高斯分布的概率密度曲线近似重合，故从图 \ref{fig2} 中我们也可以观察不同参数下混合高斯分布的概率密度曲线。

当$p = 0.0$时，显然$Z = X \sim N(\mu_1, \sigma_1^2)$，图像只有单峰且峰值在$\mu_1$附近，为正态分布；当$p = 1.0$时，显然$Z = X + Y \sim N(\mu_1 + \mu_2, \sigma_1^2 + \sigma_2^2)$，图像也只有单峰且峰值在$\mu_1 + \mu_2$附近，为正态分布；观察图像可知，理论推导和实际结果相吻合。

当$0 < p < 1$时，图像出现了两个不同的峰值，分别在 $\mu_1$ 和 $\mu_1 + \mu_2$ 附近，且随着 $p$ 的增大，$\mu_1$ 这个峰的高度逐渐降低，$\mu_1 + \mu_2$ 这个峰的高度逐渐增高；即 $\mu_1$ 附近的点的概率密度下降，而 $\mu_1 + \mu_2$ 附近的点的概率密度上升。事实上，由式 \eqref{eq4} 我们也可以清晰的认识到，其概率密度函数由两个正态分布函数以权重$p$和$1-p$加权平均后构成，因此当$p$增大时，加权$p$的一项正态分布的参数为 $\mu_1 + \mu_2$，这个正态分布出现的概率增大，因此 $\mu_1 + \mu_2$ 这个峰的高度增高；同时，加权为$1 - p$的一项正态分布参数为 $\mu_1$，这个正态分布出现的概率减小，因此 $\mu_1$ 这个峰的高度降低。这个理论推导的结果同样与图 \ref{fig2} 相符。

\begin{conclusion}
一般地，当$\sigma_1, \sigma_2$较小时，参数 $\mu_1, \mu_2, p$ 决定了峰的位置、数量，当 $p = 0$ 或 $p = 1$ 或 $\mu_2 = 0$ 时，图像仅有一个峰在 $\mu_1$ 附近；否则，图像有两个不同的峰，分别在 $\mu_1$ 附近和 $\mu_1 + \mu_2$ 附近。
\label{con1}
\end{conclusion}

\begin{conclusion}
若图像有两个峰，参数 $p$ 决定了两个峰的高度变化关系，当 $p$ 增大时，$\mu_1$ 峰的高度降低，$\mu_1 + \mu_2$ 峰的高度增高。
\label{con2}
\end{conclusion} 

由于图像的峰对应着概率密度函数的极大值，因此我们可以将结论 \ref{con1}, \ref{con2} 表述如下：

\begin{conclusion}
一般地，当$\sigma_1, \sigma_2$较小时，参数 $\mu_1, \mu_2, p$ 决定了混合高斯分布中概率密度函数的极大值点的位置、数量，当 $p = 0$ 或 $p = 1$ 或 $\mu_2 = 0$ 时，概率密度函数仅有一个极大值点 $\mu_1$；否则，概率密度函数有两个不同的极大值点，分别为 $\mu_1$ 和 $\mu_1 + \mu_2$。
\label{con3}
\end{conclusion}

\begin{conclusion}
若概率密度函数有两个极大值，参数 $p$ 决定了两个极大值的变化关系，当 $p$ 增大时，$f(\mu_1)$ 减小，$f(\mu_1 + \mu_2)$ 增大。
\label{con4}
\end{conclusion}

由于混合高斯分布本质上为两个正态分布 $N(\mu_1, \sigma_1^2), N(\mu_1 + \mu_2, \sigma_1^2 + \sigma_2^2)$ 的加权平均，因此参数 $\sigma_1, \sigma_2$ 的作用与正态分布基本相同，有：

\begin{conclusion}
参数 $\sigma_1, \sigma_2$ 表征峰的陡峭程度，$\sigma_1$ 越小，$\mu_1$ 附近的峰与$\mu_1+\mu_2$ 附近的峰都越陡峭；$\sigma_2$ 越小，$\mu_1 + \mu_2$ 附近的峰越陡峭，而不改变 $\mu_1$ 附近的峰的陡峭程度。特别地，当参数$\sigma_1, \sigma_2$ 过大时，两理论峰均过于平缓，因此在图像中无法明显体现出两个“峰”，而只能观察到一个“峰”如图\ref{fig3}所示。
\label{con5}
\end{conclusion}

\begin{figure}[H]
  \centering
  % Requires \usepackage{graphicx}
  \includegraphics[width=2.8in]{fig/fig3.jpg}\\
  \caption{参数为 $\mu_1 = 0, \sigma_1 = 5; \mu_2 = 10, \sigma_2 = 5; p = 0.5$ 的高斯混合分布的随机数频率分布直方图}\label{fig3}
\end{figure}

\section{问题二的解答}

\begin{thebibliography}{1}
\bibitem{bib1}
李曙雄,杨振海. 舍选法的几何解释及其应用[J]. 数理统计与管理(4):40-43.
\end{thebibliography}


\end{document}
